Fix defect: shuffle_batch gives ZeroDivisionError when computing capacity stat

Fixes #1853.