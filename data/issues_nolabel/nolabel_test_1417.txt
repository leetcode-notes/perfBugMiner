gradient of diag operator

@girving Hopefully I learned your lessons.  I used auto in a loop, but initialized it to the unsigned version as I found out why it was comparing signed and unsigned.  Otherwise, hopefully this is good to go.
@vrv I noticed that you changed some additional files for the diag_part operator, I must have missed them.  Thanks.
@cameronphchen Just wanted to let you know about this commit.