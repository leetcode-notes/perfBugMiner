Refactoring by extracting duplicate code into methods

I extracted duplicate code into methods to improve maintainability.