Roll forward the custom optimizers change

@samikama