Fix #7328 by checking if socket address is valid

Not sure if it's the most standard compliant way for both platforms, but I've tried my best.
Some references: POSIX and Windows.