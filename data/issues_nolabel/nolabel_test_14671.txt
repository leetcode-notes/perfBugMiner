Added mode to input_fn argument

And modified existing tests to include the mode argument.
(deleted previous PR because I accidentally pulled a bunch of other commits into the branch)