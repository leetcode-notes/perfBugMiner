Fixes to TensorArray and Functional ops

Fixes #2787.